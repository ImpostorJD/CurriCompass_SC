<form class="w-full h-full rounded-sm bg-slate-100 p-5 flex flex-col gap-4 overflow-x-auto relative" [formGroup]="studentProfileField">
    <h1 class="font-bold font-sans text-2xl uppercase">Student Records</h1>
    <div class="flex-auto rounded-md w-full flex gap-2 p-2 flex-col">
      <div class="h-[30rem] w-full flex bg-white shadow-lg">
        <table class="h-full border border-collapse flex w-full table-condensed">
          <thead class="flex flex-col h-full justify-around w-[25%]">
            <tr class="w-full h-full">
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center flex-wrap">
                Student No
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                First Name
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Middle Name
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Last Name
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Contact No.
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Email
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Enrolled at:
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Program
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Specialization
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Year Level
              </th>
              <th class="p-2 h-[9.09%] flex border border-slate-600 items-center">
                Status
              </th>
            </tr>
          </thead>
          <tbody class="flex-auto flex flex-col h-full">
            <tr class="w-full h-full flex flex-col">
              <td class="border-slate-600 border h-[9.09%] relative group/studentid">
                <input
                  class="w-full p-2 h-full group/studentid"
                  [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('studentid')?.invalid }"
                  formControlName="studentid"/>
                  @if(studentProfileField.get('studentid')?.invalid) {
                    <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                    <div class="w-0 h-0 opacity-0 studentid group-hover/studentid:opacity-100 group-focus/studentid:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                    </div>
                    <div class="z-50 bg-black rounded-md absolute min-w-[20px] min-h-[30px] text-white top-[100%] right-0 p-2 opacity-0 group-hover/studentid:opacity-100 group-focus/studentid:opacity-100">
                      @if(studentProfileField.get('studentid')?.hasError('required')){
                        Student ID is required!
                      }@else if (studentProfileField.get('studentid')?.hasError('duplicate')){
                        Student ID is already in use!
                      }
                    </div>

                  }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/userfname">
                <input
                  class="w-full p-2 h-full group/userfname"
                  formControlName="userfname"
                  [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('userfname')?.invalid }"/>
                @if(studentProfileField.get('userfname')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="group-focus/userfname:opacity-100 w-0 h-0 opacity-0 group-hover/userfname:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="group-hover/userfname:opacity-100 group-focus/userfname:opacity-100 z-50 bg-black rounded-md absolute min-w-[20px] min-h-[30px] text-white top-[100%] right-0 p-2 opacity-0">
                    @if(studentProfileField.get('userfname')?.hasError('required')){
                      First name is required!
                    }@else if (studentProfileField.get('userfname')?.hasError('pattern')) {
                      First name is in invalid format!
                    }
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/usermiddle">
                <input class="w-full p-2 h-full group/usermiddle"
                  [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('usermiddle')?.invalid }"
                  formControlName="usermiddle"/>
                @if(studentProfileField.get('usermiddle')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/usermiddle:opacity-100 group-hover/usermiddle:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/usermiddle:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/usermiddle:opacity-100">
                    @if(studentProfileField.get('usermiddle')?.hasError('required')){
                      Middle name is required!
                    }@else if (studentProfileField.get('usermiddle')?.hasError('pattern')) {
                      Middle name is in invalid format!
                    }
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/userlname">
                <input class="w-full p-2 h-full group/userlname"
                [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('userlname')?.invalid }"
                formControlName="userlname"/>
                @if(studentProfileField.get('userlname')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/userlname:opacity-100 group-hover/userlname:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/userlname:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/userlname:opacity-100">
                    @if(studentProfileField.get('userlname')?.hasError('required')){
                      Last name is required!
                    }@else if (studentProfileField.get('userlname')?.hasError('pattern')) {
                      Last name is in invalid format!
                    }
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/contact_no">
                <input class="w-full p-2 h-full group/contact_no"
                  [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('contact_no')?.invalid }"
                  formControlName="contact_no"/>
                @if(studentProfileField.get('contact_no')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/contact_no:opacity-100 group-hover/contact_no:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/contact_no:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/contact_no:opacity-100">
                    @if(studentProfileField.get('contact_no')?.hasError('required')){
                      Contact number is required!
                    }
                    @else if(studentProfileField.get('contact_no')?.hasError('pattern')){
                      Contact number is in invalid format!
                    }
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/email">
                <input class="w-full p-2 h-full group/email"
                  [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('email')?.invalid }"
                  formControlName="email"/>
                  @if(studentProfileField.get('email')?.invalid) {
                    <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                    <div class="w-0 h-0 opacity-0 group-focus/email:opacity-100 group-hover/email:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                    </div>
                    <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/email:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/email:opacity-100">
                      @if(studentProfileField.get('email')?.hasError('required')){
                        Email is required!
                      }@else if(studentProfileField.get('email')?.hasError('email')){
                        Email is in invalid format!
                      }@else if(studentProfileField.get('email')?.hasError('duplicate')){
                        Email is already in use!
                      }
                    </div>
                  }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/sy">
                <select class="w-full p-2 h-full group/sy"
                [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('sy')?.invalid }"
                formControlName="sy">
                  <option [ngValue]="null" disabled selected>
                    Please Select
                  </option>
                  @for(sy of school_years; track $index){
                    <option [ngValue]="sy.sy">
                      {{ dateformat.formatToYear(sy.sy_start)  + " - " + dateformat.formatToYear(sy.sy_end) }}
                    </option>
                  }
                </select>
                @if(studentProfileField.get('sy')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/sy:opacity-100 group-hover/sy:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/sy:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/sy:opacity-100">
                    Enrolled at is required!
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/program">
                <select class="w-full p-2 h-full border-[0px] group/program"
                  [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('program')?.invalid }"
                  (change)="setSpecializationsEvent($event)"
                  formControlName="program">
                  <option [ngValue]="null" disabled selected>
                    N/A
                  </option>
                  @for(program of programs; track $index){
                    <option [ngValue]="program.programid">
                      {{program.programdesc}}
                    </option>
                  }
                </select>
                @if(studentProfileField.get('program')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/program:opacity-100 group-hover/program:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/program:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/program:opacity-100">
                    Program is required!
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%]">
                <select class="w-full p-2 h-full border-[0px]" formControlName="specialization"
                (change)="changeSpecialization()">
                  <option [ngValue]="null" disabled selected>
                    N/A
                  </option>
                  @for(c of specializations; track $index){
                    <option [ngValue]="c.specialization">
                      {{ (c.specialization != null ? c.specialization : "None")  +  " (" + dateformat.formatToYear(c.school_year.sy_start)  + " - " + dateformat.formatToYear(c.school_year.sy_end) + ")"}}
                    </option>
                  }
                </select>
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/year_level">
                <select class="w-full p-2 h-full group/year_level"
                [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('year_level_id')?.invalid }"
                formControlName="year_level_id">
                  <option [value]="null" selected disabled>
                    None
                  </option>
                  @for(y of year_levels; track $index){
                    <option [ngValue]="y.year_level_id">
                      {{y.year_level_desc}}
                    </option>
                  }
                </select>
                @if(studentProfileField.get('year_level_id')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/year_level:opacity-100 group-hover/year_level:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/year_level:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/year_level:opacity-100">
                    Year Level is required!
                  </div>
                }
              </td>
              <td class="border-slate-600 border h-[9.09%] relative group/status">
                <select class="w-full p-2 h-full group/status"
                [ngClass]="{'border-red-600 border-[1px]': studentProfileField.get('status')?.invalid }"
                formControlName="status">
                  <option [value]="''" disabled selected>
                    Please Select
                  </option>
                  <option value="Regular">
                    Regular
                  </option>
                  <option value="Irregular">
                    Irregular
                  </option>
                  <option value="Graduated">
                    Graduated
                  </option>
                  <option value="Inactive">
                    Inactive
                  </option>
                </select>
                @if(studentProfileField.get('status')?.invalid) {
                  <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                  <div class="w-0 h-0 opacity-0 group-focus/status:opacity-100 group-hover/status:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                  </div>
                  <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus/status:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover/status:opacity-100">
                    Status is required!
                  </div>
                }
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="h-auto w-full">
        <table class="flex-auto flex flex-col w-full mb-[1rem] border-[1px] border-slate-400">
          <thead class="w-full flex flex-row bg-slate-300 h-[3rem]">
            <tr class="h-full w-full flex flex-row">
              <th class="border border-slate-600 w-[10%] flex items-center justify-center">
                Course Code
              </th>
              <th class="border border-slate-600 w-[10%] flex items-center justify-center">
                Units
              </th>
              <th class="border border-slate-600 w-[10%] flex items-center justify-center">
                Year Level
              </th>
              <th class="border border-slate-600 w-[10%] flex items-center justify-center">
                Semester
              </th>
              <th class="border border-slate-600 w-[15%] flex items-center justify-center">
                SY Taken
              </th>
              <th class="border border-slate-600 w-[15%] flex items-center justify-center">
                Sem Taken
              </th>
              <th class="border border-slate-600 w-[15%] flex items-center justify-center">
                Grade
              </th>
              <th class="border border-slate-600 w-[15%] flex items-center justify-center">
                Remark
              </th>
            </tr>
          </thead>
          <tbody class="h-[25rem] overflow-y-auto">
            @if(curriculumSubjects != null && subjectsTakenArray.length > 0){
              @for(cs of curriculumSubjects; track $index){
                <tr class="flex flex-row w-full hover:bg-green-300">
                  <td class="border border-slate-600 w-[10%] flex items-center justify-center">
                    {{ cs.subjects.subjectcode }}
                  </td>
                  <td class="border border-slate-600 w-[10%] flex items-center justify-center">
                    {{ cs.subjects.subjectcredits }}
                  </td>
                  <td class="border border-slate-600 w-[10%] flex items-center justify-center">
                    {{ cs.year_level.year_level_desc }}
                  </td>
                  <td class="border border-slate-600 w-[10%] flex items-center justify-center">
                    {{ cs.semesters.semdesc }}
                  </td>
                  <td class="border border-slate-600 w-[15%] flex items-center justify-center relative group">
                    <select
                    [ngClass]="{'border-red-600 border-[1px]': getSchoolYearControl($index).invalid }"
                      class="h-full w-full p-2" [formControl]="getSchoolYearControl($index)">
                      <option [ngValue]="null" disabled selected>
                        Please Select
                      </option>
                      @for(sy of school_years; track $index){
                        <option [ngValue]="sy.sy">
                          {{ dateformat.formatToYear(sy.sy_start)  + " - " + dateformat.formatToYear(sy.sy_end) }}
                        </option>
                      }
                    </select>
                    @if(getSchoolYearControl($index).invalid){
                      <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                      <div class="w-0 h-0 opacity-0 group-focus:opacity-100 group-hover:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                      </div>
                      <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover:opacity-100">
                        School Year is required!
                      </div>
                    }
                  </td>
                  <td class="border border-slate-600 w-[15%] flex items-center justify-center relative group">
                    <select class="h-full w-full p-2"
                      [ngClass]="{'border-red-600 border-[1px]': getTakenAtControl($index).invalid }"
                      [formControl]="getTakenAtControl($index)">
                      <option [ngValue]="null" disabled selected>
                        Please Select
                      </option>
                      <option value="Credited">
                        Credited
                      </option>
                      <option value="Sem 1">
                        1st Trimester
                      </option>
                      <option value="Sem 2">
                        2nd Trimester
                      </option>
                      <option value="Sem 3">
                        3rd Trimester
                      </option>
                    </select>
                    @if(getTakenAtControl($index).invalid){
                      <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                      <div class="w-0 h-0 opacity-0 group-focus:opacity-100 group-hover:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                      </div>
                      <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover:opacity-100">
                        Taken at is required
                      </div>
                    }
                  </td>
                  <td class="border border-slate-600 w-[15%] flex items-center justify-center group relative">
                    <select
                      class="h-full w-full p-2"
                      [ngClass]="{'border-red-600 border-[1px]': getGradeControl($index).invalid }"
                      [formControl]="getGradeControl($index)" (change)="changeGradeRemark($index)">
                      <option [ngValue]="null" disabled selected>
                        Please Select
                      </option>
                      <option [ngValue]="1">
                        1
                      </option>
                      <option [ngValue]="1.25">
                        1.25
                      </option>
                      <option [ngValue]="1.5">
                        1.50
                      </option>
                      <option [ngValue]="1.5">
                        1.75
                      </option>
                      <option [ngValue]="2">
                        2
                      </option>
                      <option [ngValue]="2.25">
                        2.25
                      </option>
                      <option [ngValue]="2.5">
                        2.50
                      </option>
                      <option [ngValue]="2.75">
                        2.75
                      </option>
                      <option [ngValue]="3">
                        3
                      </option>
                      <option [ngValue]="5">
                        5
                      </option>
                    </select>
                    @if(getGradeControl($index).invalid){
                      <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                      <div class="w-0 h-0 opacity-0 group-focus:opacity-100 group-hover:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                      </div>
                      <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover:opacity-100">
                        Grade is required
                      </div>
                    }
                  </td>
                  <td class="border border-slate-600 w-[15%] flex items-center justify-center relative group">
                    <select
                      class="w-full p-2 h-full group"
                      [ngClass]="{'border-red-600 border-[1px]': getRemarkControl($index).invalid }"
                      [formControl]="getRemarkControl($index)">
                      <option value="None">
                        None
                      </option>
                      <option value="Excellent">
                        Excellent
                      </option>
                      <option value="Very Good">
                        Very Good
                      </option>
                      <option value="Good">
                        Good
                      </option>
                      <option value="Fair">
                        Fair
                      </option>
                      <option value="Passing">
                        Passing
                      </option>
                      <option value="Failed">
                        Failed
                      </option>
                      <option value="Incomplete">
                        Incomplete
                      </option>
                      <option value="Widthdrawn">
                        Widthdrawn
                      </option>
                    </select>
                    @if(getRemarkControl($index).invalid) {
                      <img class="absolute right-0 top-0 h-full" src="../../../assets/exclamation-mark-inside-a-circle-svgrepo-com.svg"/>
                      <div class="w-0 h-0 opacity-0 group-focus/remark:opacity-100 group-hover:opacity-100 absolute top-[80%] right-4 border-l-[5px] border-l-transparent border-b-[10px] border-b-black border-r-[5px] border-r-transparent">
                      </div>
                      <div class="bg-black rounded-md absolute min-w-[20px] min-h-[30px] z-50 group-focus:opacity-100 text-white top-[100%] right-0 p-2 opacity-0 group-hover:opacity-100">
                        Remark/s is required!
                      </div>
                    }
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
      <div class="flex h-[3rem] justify-end gap-2">
        <a [routerLink]="'/students'" class="w-full flex flex-row gap-2 items-center justify-center px-4 bg-slate-700 py-2 rounded-md text-white hover:bg-slate-900 transition-all uppercase">
          <i class="material-symbols-outlined">
            close
          </i>
          <span class="hidden lg:block">
            Discard Changes
          </span>
        </a>
        <button class="w-full flex flex-row gap-2 px-4 py-2 items-center justify-center bg-green-600 border-[1px] rounded-md text-white transition-all hover:bg-green-800 uppercase" (click)="handleSubmit()">
          <i class="material-symbols-outlined">edit</i>
          <span class="hidden lg:block">
            Save Changes
          </span>
        </button>
      </div>
    </div>
    @if(loading.loading){
      <app-loading-component></app-loading-component>
    }
  </form>
